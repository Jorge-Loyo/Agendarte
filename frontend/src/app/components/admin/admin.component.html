<div class="admin-container">
  <!-- Header -->
  <div class="header">
    <h1>üõ°Ô∏è Panel de Administraci√≥n</h1>
    <button class="btn-create" (click)="showCreateForm = !showCreateForm">
      {{ showCreateForm ? 'Cancelar' : '+ Crear Usuario' }}
    </button>
  </div>

  <!-- Create User Form -->
  <div class="create-form" *ngIf="showCreateForm">
    <div class="form-card">
      <h3>Crear Nuevo Usuario</h3>
      
      <div class="form-grid">
        <div class="form-group">
          <label>Email *</label>
          <input type="email" [(ngModel)]="newUser.email" placeholder="usuario@ejemplo.com">
        </div>
        
        <div class="form-group">
          <label>Contrase√±a *</label>
          <input type="password" [(ngModel)]="newUser.password" placeholder="M√≠nimo 8 caracteres">
        </div>
        
        <div class="form-group">
          <label>Rol *</label>
          <select [(ngModel)]="newUser.role">
            <option *ngFor="let role of roles" [value]="role.value">{{ role.label }}</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>Nombre *</label>
          <input type="text" [(ngModel)]="newUser.firstName" placeholder="Nombre">
        </div>
        
        <div class="form-group">
          <label>Apellido *</label>
          <input type="text" [(ngModel)]="newUser.lastName" placeholder="Apellido">
        </div>
        
        <div class="form-group">
          <label>DNI</label>
          <input type="text" [(ngModel)]="newUser.dni" placeholder="12345678">
        </div>
        
        <div class="form-group">
          <label>Tel√©fono</label>
          <input type="text" [(ngModel)]="newUser.phone" placeholder="+54911123456">
        </div>
        
        <div class="form-group" *ngIf="newUser.role === 'professional'">
          <label>Especialidad</label>
          <input type="text" [(ngModel)]="newUser.specialty" placeholder="Cardiolog√≠a">
        </div>
        
        <div class="form-group" *ngIf="newUser.role === 'professional'">
          <label>Matr√≠cula</label>
          <input type="text" [(ngModel)]="newUser.licenseNumber" placeholder="MP12345">
        </div>
      </div>
      
      <div class="form-actions">
        <button class="btn-save" (click)="createUser()">Crear Usuario</button>
        <button class="btn-cancel" (click)="showCreateForm = false; resetForm()">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div class="loading" *ngIf="loading">
    <div class="spinner"></div>
    <p>Cargando usuarios...</p>
  </div>

  <!-- Users Table -->
  <div class="users-section" *ngIf="!loading">
    <div class="table-card">
      <h3>Usuarios del Sistema ({{ users.length }})</h3>
      
      <div class="table-container">
        <table class="users-table">
          <thead>
            <tr>
              <th>Usuario</th>
              <th>Rol</th>
              <th>Estado</th>
              <th>Informaci√≥n</th>
              <th>Fecha Creaci√≥n</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of users" [class.inactive]="!user.isActive">
              <td>
                <div class="user-info">
                  <div class="user-avatar">
                    {{ (user.profile?.firstName || 'U').charAt(0) }}
                  </div>
                  <div class="user-details">
                    <strong>{{ user.profile?.firstName }} {{ user.profile?.lastName }}</strong>
                    <small>{{ user.email }}</small>
                  </div>
                </div>
              </td>
              
              <td>
                <select 
                  [value]="user.role" 
                  (change)="updateUserRole(user, ($event.target as HTMLSelectElement).value)"
                  [disabled]="!canManageUser(user)"
                  class="role-select">
                  <option *ngFor="let role of roles" [value]="role.value">{{ role.label }}</option>
                </select>
              </td>
              
              <td>
                <span class="status" [class]="user.isActive ? 'active' : 'inactive'">
                  {{ user.isActive ? 'Activo' : 'Inactivo' }}
                </span>
              </td>
              
              <td>
                <div class="info-details">
                  <div *ngIf="user.profile?.dni">DNI: {{ user.profile.dni }}</div>
                  <div *ngIf="user.profile?.phone">Tel: {{ user.profile.phone }}</div>
                  <div *ngIf="user.professional?.specialty">{{ user.professional.specialty }}</div>
                  <div *ngIf="user.professional?.licenseNumber">MP: {{ user.professional.licenseNumber }}</div>
                </div>
              </td>
              
              <td>
                {{ user.createdAt | date:'dd/MM/yyyy' }}
              </td>
              
              <td>
                <div class="actions">
                  <button 
                    class="btn-toggle" 
                    (click)="toggleUserStatus(user)"
                    [disabled]="!canManageUser(user)"
                    [title]="user.isActive ? 'Desactivar' : 'Activar'">
                    {{ user.isActive ? 'üîí' : 'üîì' }}
                  </button>
                  
                  <button 
                    class="btn-delete" 
                    (click)="deleteUser(user)"
                    [disabled]="!canDeleteUser(user)"
                    *ngIf="canDeleteUser(user)"
                    title="Eliminar">
                    üóëÔ∏è
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>