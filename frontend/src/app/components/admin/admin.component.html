<div class="admin-container">
  <!-- Header -->
  <div class="header">
    <h1>üõ°Ô∏è Panel de Administraci√≥n</h1>
  </div>

  <!-- Menu Tabs -->
  <div class="menu-tabs">
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'users'"
      (click)="activeTab = 'users'">
      üë• Usuarios
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'patients'"
      (click)="activeTab = 'patients'">
      üßë‚Äç‚öïÔ∏è Pacientes
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'appointments'"
      (click)="activeTab = 'appointments'">
      üìÖ Turnos
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'specialties'"
      (click)="activeTab = 'specialties'">
      üè• Especialidades
    </button>
  </div>

  <!-- Users Section -->
  <div class="section-content" *ngIf="activeTab === 'users'">
    <div class="section-header">
      <h2>Gesti√≥n de Usuarios</h2>
      <div class="header-actions">
        <button class="btn-danger" (click)="deleteTestUsers()" *ngIf="currentUser?.role === 'master'">
          üóëÔ∏è Limpiar Pruebas
        </button>
        <button class="btn-create" (click)="showCreateForm = !showCreateForm">
          {{ showCreateForm ? 'Cancelar' : '+ Crear Usuario' }}
        </button>
      </div>
    </div>

    <!-- Create User Form -->
    <div class="create-form" *ngIf="showCreateForm">
    <div class="form-card">
      <h3>Crear Nuevo Usuario</h3>
      
      <div class="form-grid">
        <div class="form-group">
          <label>Email *</label>
          <input type="email" [(ngModel)]="newUser.email" placeholder="usuario@ejemplo.com">
        </div>
        
        <div class="form-group">
          <label>Contrase√±a *</label>
          <input type="password" [(ngModel)]="newUser.password" placeholder="M√≠nimo 8 caracteres">
        </div>
        
        <div class="form-group">
          <label>Rol *</label>
          <select [(ngModel)]="newUser.role">
            <option *ngFor="let role of roles" [value]="role.value">{{ role.label }}</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>Nombre *</label>
          <input type="text" [(ngModel)]="newUser.firstName" placeholder="Nombre">
        </div>
        
        <div class="form-group">
          <label>Apellido *</label>
          <input type="text" [(ngModel)]="newUser.lastName" placeholder="Apellido">
        </div>
        
        <div class="form-group">
          <label>DNI</label>
          <input type="text" [(ngModel)]="newUser.dni" placeholder="12345678">
        </div>
        
        <div class="form-group">
          <label>Tel√©fono</label>
          <input type="text" [(ngModel)]="newUser.phone" placeholder="+54911123456">
        </div>
        
        <div class="form-group" *ngIf="newUser.role === 'professional'">
          <label>Especialidad</label>
          <select [(ngModel)]="newUser.specialty">
            <option value="">Seleccionar especialidad</option>
            <option *ngFor="let specialty of specialties" [value]="specialty.name">{{ specialty.name }}</option>
          </select>
        </div>
        
        <div class="form-group" *ngIf="newUser.role === 'professional'">
          <label>Matr√≠cula</label>
          <input type="text" [(ngModel)]="newUser.licenseNumber" placeholder="MP12345">
        </div>
      </div>
      
      <div class="form-actions">
        <button class="btn-save" (click)="createUser()">Crear Usuario</button>
        <button class="btn-cancel" (click)="showCreateForm = false; resetForm()">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div class="loading" *ngIf="loading">
    <div class="spinner"></div>
    <p>Cargando usuarios...</p>
  </div>

  <!-- Users Table -->
  <div class="users-section" *ngIf="!loading">
    <div class="table-card">
      <h3>Usuarios del Sistema ({{ users.length }})</h3>
      
      <div class="table-container">
        <table class="users-table">
          <thead>
            <tr>
              <th>Usuario</th>
              <th>Rol</th>
              <th>Estado</th>
              <th>Informaci√≥n</th>
              <th>Fecha Creaci√≥n</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of users" [class.inactive]="!user.isActive">
              <td>
                <div class="user-info">
                  <div class="user-avatar">
                    {{ (user.profile?.firstName || 'U').charAt(0) }}
                  </div>
                  <div class="user-details">
                    <strong>{{ user.profile?.firstName }} {{ user.profile?.lastName }}</strong>
                    <small>{{ user.email }}</small>
                  </div>
                </div>
              </td>
              
              <td>
                <span class="role-badge" [class]="user.role">
                  {{ getRoleLabel(user.role) }}
                </span>
              </td>
              
              <td>
                <span class="status" [class]="user.isActive ? 'active' : 'inactive'">
                  {{ user.isActive ? 'Activo' : 'Inactivo' }}
                </span>
              </td>
              
              <td>
                <div class="info-details">
                  <div *ngIf="user.profile?.dni">DNI: {{ user.profile.dni }}</div>
                  <div *ngIf="user.profile?.phone">Tel: {{ user.profile.phone }}</div>
                  <div *ngIf="user.professional?.specialty">{{ user.professional.specialty }}</div>
                  <div *ngIf="user.professional?.licenseNumber">MP: {{ user.professional.licenseNumber }}</div>
                </div>
              </td>
              
              <td>
                {{ user.createdAt | date:'dd/MM/yyyy' }}
              </td>
              
              <td>
                <div class="actions">
                  <button 
                    class="btn-edit" 
                    (click)="editUser(user)"
                    [disabled]="!canManageUser(user)"
                    title="Editar">
                    ‚úèÔ∏è
                  </button>
                  
                  <button 
                    class="btn-toggle" 
                    (click)="toggleUserStatus(user)"
                    [disabled]="!canManageUser(user)"
                    [title]="user.isActive ? 'Desactivar' : 'Activar'">
                    {{ user.isActive ? 'üîí' : 'üîì' }}
                  </button>
                  
                  <button 
                    class="btn-delete" 
                    (click)="deleteUser(user)"
                    [disabled]="!canDeleteUser(user)"
                    *ngIf="canDeleteUser(user)"
                    title="Eliminar">
                    üóëÔ∏è
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  </div>

  <!-- Patients Section -->
  <div class="section-content" *ngIf="activeTab === 'patients'">
    <div class="section-header">
      <h2>Registro de Pacientes</h2>
      <button class="btn-create" (click)="showCreatePatient = !showCreatePatient">
        {{ showCreatePatient ? 'Cancelar' : '+ Registrar Paciente' }}
      </button>
    </div>

    <!-- Create Patient Form -->
    <div class="create-form" *ngIf="showCreatePatient">
      <div class="form-card">
        <h3>Registrar Nuevo Paciente</h3>
        
        <div class="form-grid">
          <div class="form-group">
            <label>Email *</label>
            <input type="email" [(ngModel)]="newPatient.email" placeholder="paciente@ejemplo.com">
          </div>
          
          <div class="form-group">
            <label>Nombre *</label>
            <input type="text" [(ngModel)]="newPatient.firstName" placeholder="Nombre">
          </div>
          
          <div class="form-group">
            <label>Apellido *</label>
            <input type="text" [(ngModel)]="newPatient.lastName" placeholder="Apellido">
          </div>
          
          <div class="form-group">
            <label>DNI *</label>
            <input type="text" [(ngModel)]="newPatient.dni" placeholder="12345678">
          </div>
          
          <div class="form-group">
            <label>Tel√©fono</label>
            <input type="text" [(ngModel)]="newPatient.phone" placeholder="+54911123456">
          </div>
          
          <div class="form-group">
            <label>Edad</label>
            <input type="number" [(ngModel)]="newPatient.age" placeholder="25">
          </div>
          
          <div class="form-group">
            <label>G√©nero</label>
            <select [(ngModel)]="newPatient.gender">
              <option value="">Seleccionar</option>
              <option value="M">Masculino</option>
              <option value="F">Femenino</option>
              <option value="Other">Otro</option>
            </select>
          </div>
          
          <div class="form-group full-width">
            <label>Direcci√≥n</label>
            <input type="text" [(ngModel)]="newPatient.address" placeholder="Direcci√≥n completa">
          </div>
        </div>
        
        <div class="form-options">
          <label class="checkbox-label">
            <input type="checkbox" [(ngModel)]="createAndSchedule">
            Crear paciente y agendar turno inmediatamente
          </label>
        </div>
        
        <div class="form-actions">
          <button class="btn-save" (click)="createPatient()">{{ createAndSchedule ? 'Crear y Agendar' : 'Crear Paciente' }}</button>
          <button class="btn-cancel" (click)="showCreatePatient = false; resetPatientForm()">Cancelar</button>
        </div>
      </div>
    </div>

    <!-- Patients List -->
    <div class="patients-section" *ngIf="!loading">
      <div class="table-card">
        <h3>Pacientes Registrados ({{ patients.length }})</h3>
        
        <div class="search-bar">
          <input 
            type="text" 
            placeholder="Buscar paciente por nombre, DNI o email..."
            [(ngModel)]="patientSearchTerm"
            (input)="filterPatients()"
            class="search-input">
        </div>
        
        <div class="table-container">
          <table class="patients-table">
            <thead>
              <tr>
                <th>Paciente</th>
                <th>DNI</th>
                <th>Contacto</th>
                <th>Edad</th>
                <th>Registro</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let patient of filteredPatients">
                <td>
                  <div class="patient-info">
                    <div class="patient-avatar">
                      {{ (patient.profile?.firstName || 'P').charAt(0) }}
                    </div>
                    <div class="patient-details">
                      <strong>{{ patient.profile?.firstName }} {{ patient.profile?.lastName }}</strong>
                      <small>{{ patient.email }}</small>
                    </div>
                  </div>
                </td>
                <td>{{ patient.profile?.dni || 'Sin DNI' }}</td>
                <td>
                  <div class="contact-info">
                    <div *ngIf="patient.profile?.phone">{{ patient.profile.phone }}</div>
                    <div *ngIf="patient.profile?.address" class="address">{{ patient.profile.address }}</div>
                  </div>
                </td>
                <td>{{ patient.profile?.age || '-' }}</td>
                <td>{{ patient.createdAt | date:'dd/MM/yyyy' }}</td>
                <td>
                  <div class="actions">
                    <button 
                      class="btn-action btn-schedule"
                      (click)="scheduleForPatient(patient)"
                      title="Agendar turno">
                      üìÖ
                    </button>
                    <button 
                      class="btn-action btn-edit"
                      (click)="editPatient(patient)"
                      title="Editar">
                      ‚úèÔ∏è
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Appointments Section -->
  <div class="section-content" *ngIf="activeTab === 'appointments'">
    <app-admin-appointments></app-admin-appointments>
  </div>

  <!-- Specialties Section -->
  <div class="section-content" *ngIf="activeTab === 'specialties'">
    <div class="section-header">
      <h2>Gesti√≥n de Especialidades</h2>
      <button class="btn-create" (click)="showCreateSpecialty = !showCreateSpecialty">
        {{ showCreateSpecialty ? 'Cancelar' : '+ Crear Especialidad' }}
      </button>
    </div>

    <!-- Create Specialty Form -->
    <div class="create-form" *ngIf="showCreateSpecialty">
      <div class="form-card">
        <h3>Crear Nueva Especialidad</h3>
        
        <div class="form-grid">
          <div class="form-group">
            <label>Nombre *</label>
            <input type="text" [(ngModel)]="newSpecialty.name" placeholder="Cardiolog√≠a">
          </div>
          
          <div class="form-group">
            <label>Descripci√≥n</label>
            <textarea [(ngModel)]="newSpecialty.description" placeholder="Descripci√≥n de la especialidad" rows="3"></textarea>
          </div>
        </div>
        
        <div class="form-actions">
          <button class="btn-save" (click)="createSpecialty()">Crear Especialidad</button>
          <button class="btn-cancel" (click)="showCreateSpecialty = false; resetSpecialtyForm()">Cancelar</button>
        </div>
      </div>
    </div>

    <!-- Specialties List -->
    <div class="specialties-section" *ngIf="!loading">
      <div class="table-card">
        <h3>Especialidades ({{ specialties.length }})</h3>
        
        <div class="table-container">
          <table class="specialties-table">
            <thead>
              <tr>
                <th>Nombre</th>
                <th>Descripci√≥n</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let specialty of specialties">
                <td><strong>{{ specialty.name }}</strong></td>
                <td>{{ specialty.description || 'Sin descripci√≥n' }}</td>
                <td>
                  <span class="status" [class]="specialty.isActive ? 'active' : 'inactive'">
                    {{ specialty.isActive ? 'Activa' : 'Inactiva' }}
                  </span>
                </td>
                <td>
                  <div class="actions">
                    <button class="btn-toggle" (click)="toggleSpecialtyStatus(specialty)">
                      {{ specialty.isActive ? 'üîí' : 'üîì' }}
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
    <!-- Edit User Form -->
    <div class="create-form" *ngIf="showEditForm">
      <div class="form-card">
        <h3>Editar Usuario</h3>
        
        <div class="form-grid">
          <div class="form-group">
            <label>Email *</label>
            <input type="email" [(ngModel)]="editingUser.email" placeholder="usuario@ejemplo.com">
          </div>
          
          <div class="form-group">
            <label>Nueva Contrase√±a</label>
            <input type="password" [(ngModel)]="editingUser.password" placeholder="Dejar vac√≠o para no cambiar">
          </div>
          
          <div class="form-group">
            <label>Rol *</label>
            <select [(ngModel)]="editingUser.role">
              <option *ngFor="let role of roles" [value]="role.value">{{ role.label }}</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Nombre *</label>
            <input type="text" [(ngModel)]="editingUser.firstName" placeholder="Nombre">
          </div>
          
          <div class="form-group">
            <label>Apellido *</label>
            <input type="text" [(ngModel)]="editingUser.lastName" placeholder="Apellido">
          </div>
          
          <div class="form-group">
            <label>DNI</label>
            <input type="text" [(ngModel)]="editingUser.dni" placeholder="12345678">
          </div>
          
          <div class="form-group">
            <label>Tel√©fono</label>
            <input type="text" [(ngModel)]="editingUser.phone" placeholder="+54911123456">
          </div>
          
          <div class="form-group" *ngIf="editingUser.role === 'professional'">
            <label>Especialidad</label>
            <select [(ngModel)]="editingUser.specialty">
              <option value="">Seleccionar especialidad</option>
              <option *ngFor="let specialty of specialties" [value]="specialty.name">{{ specialty.name }}</option>
            </select>
          </div>
          
          <div class="form-group" *ngIf="editingUser.role === 'professional'">
            <label>Matr√≠cula</label>
            <input type="text" [(ngModel)]="editingUser.licenseNumber" placeholder="MP12345">
          </div>
        </div>
        
        <div class="form-actions">
          <button class="btn-save" (click)="updateUser()">Actualizar Usuario</button>
          <button class="btn-cancel" (click)="cancelEdit()">Cancelar</button>
        </div>
      </div>
    </div>