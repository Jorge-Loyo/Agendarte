<div class="notes-container">
  <!-- Header -->
  <div class="header">
    <button class="back-btn" (click)="goBack()">
      â† Volver a Agenda
    </button>
    <h2>Notas de Consulta</h2>
    <div class="save-status">
      <span *ngIf="saving" class="saving">Guardando...</span>
      <span *ngIf="hasUnsavedChanges() && !saving" class="unsaved">Cambios sin guardar</span>
      <span *ngIf="!hasUnsavedChanges() && !saving" class="saved">Guardado</span>
    </div>
  </div>

  <!-- Loading -->
  <div class="loading" *ngIf="loading">
    <div class="spinner"></div>
    <p>Cargando consulta...</p>
  </div>

  <!-- Appointment Info -->
  <div class="appointment-info" *ngIf="appointment && !loading">
    <div class="info-card">
      <h3>InformaciÃ³n de la Consulta</h3>
      <div class="info-grid">
        <div class="info-item">
          <label>Paciente:</label>
          <span>{{ appointment.patient.name }}</span>
        </div>
        <div class="info-item">
          <label>DNI:</label>
          <span>{{ appointment.patient.dni }}</span>
        </div>
        <div class="info-item">
          <label>Fecha:</label>
          <span>{{ formatDate(appointment.date) }}</span>
        </div>
        <div class="info-item">
          <label>Hora:</label>
          <span>{{ appointment.time }}</span>
        </div>
        <div class="info-item">
          <label>Estado:</label>
          <span class="status" [class]="appointment.status">{{ appointment.status }}</span>
        </div>
        <div class="info-item" *ngIf="appointment.updatedAt">
          <label>Ãšltima modificaciÃ³n:</label>
          <span>{{ appointment.updatedAt | date:'dd/MM/yyyy HH:mm' }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Notes Editor -->
  <div class="notes-editor" *ngIf="appointment && !loading">
    <div class="editor-card">
      <div class="editor-header">
        <h3>Notas de la Consulta</h3>
        <button class="save-btn" (click)="manualSave()" [disabled]="saving || !hasUnsavedChanges()">
          <span *ngIf="!saving">ğŸ’¾ Guardar</span>
          <span *ngIf="saving">â³ Guardando...</span>
        </button>
      </div>
      
      <div class="editor-toolbar">
        <small class="help-text">
          ğŸ’¡ Las notas se guardan automÃ¡ticamente. Puedes usar formato bÃ¡sico como **negrita** y *cursiva*.
        </small>
      </div>
      
      <textarea 
        class="notes-textarea"
        [(ngModel)]="notes"
        (input)="onNotesChange()"
        placeholder="Escribe aquÃ­ las notas de la consulta...

Ejemplo:
- Motivo de consulta: Control rutinario
- SÃ­ntomas: Sin sÃ­ntomas particulares
- Examen fÃ­sico: Normal
- DiagnÃ³stico: Paciente en buen estado general
- Tratamiento: Continuar con medicaciÃ³n actual
- PrÃ³xima cita: En 3 meses"
        rows="15">
      </textarea>
      
      <div class="editor-footer">
        <div class="word-count">
          {{ notes.length }} caracteres
        </div>
        <div class="auto-save-info">
          <small>ğŸ’¾ Guardado automÃ¡tico cada 2 segundos</small>
        </div>
      </div>
    </div>
  </div>
</div>