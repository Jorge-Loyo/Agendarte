<div class="profile-container">
  <!-- Header -->
  <div class="profile-header">
    <button class="btn-back" (click)="goBack()">‚Üê Volver</button>
    <h1>Mi Perfil</h1>
    <button class="btn-edit" (click)="toggleEditMode()">
      {{ editMode ? 'Cancelar' : 'Editar Perfil' }}
    </button>
  </div>

  <!-- Profile Content -->
  <div class="profile-content">
    <!-- User Avatar Section -->
    <div class="avatar-section">
      <div class="avatar-container">
        <div class="user-avatar-large" *ngIf="!imagePreview && !profileData.profileImage">
          {{ (currentUser?.profile?.firstName || currentUser?.email || 'U').charAt(0).toUpperCase() }}
        </div>
        <img 
          *ngIf="imagePreview || profileData.profileImage" 
          [src]="imagePreview || profileData.profileImage" 
          alt="Foto de perfil"
          class="profile-image">
        
        <div class="image-upload" *ngIf="editMode">
          <input 
            type="file" 
            #fileInput 
            (change)="onFileSelected($event)"
            accept="image/*"
            style="display: none;">
          <button type="button" class="btn-upload" (click)="fileInput.click()">
            üì∑ Cambiar Foto
          </button>
          <button 
            type="button" 
            class="btn-remove" 
            *ngIf="imagePreview || profileData.profileImage"
            (click)="removeImage()">
            üóëÔ∏è Quitar
          </button>
        </div>
      </div>
      
      <div class="user-info">
        <h2>{{ currentUser?.profile?.firstName || 'Usuario' }} {{ currentUser?.profile?.lastName || '' }}</h2>
        <p class="user-role">{{ currentUser?.role | titlecase }}</p>
        <p class="user-email">{{ currentUser?.email }}</p>
      </div>
    </div>

    <!-- Success Message -->
    <div class="success-message" *ngIf="message">
      {{ message }}
    </div>

    <!-- Profile Form -->
    <div class="profile-form">
      <form (ngSubmit)="onSubmit()" #profileForm="ngForm" *ngIf="editMode; else viewMode">
        <div class="form-sections">
          <!-- Personal Information -->
          <div class="form-section">
            <h3>Informaci√≥n Personal</h3>
            <div class="form-row">
              <div class="form-group">
                <label>Nombre *</label>
                <input 
                  type="text" 
                  [(ngModel)]="profileData.firstName"
                  name="firstName"
                  required
                  class="form-control">
              </div>
              <div class="form-group">
                <label>Apellido *</label>
                <input 
                  type="text" 
                  [(ngModel)]="profileData.lastName"
                  name="lastName"
                  required
                  class="form-control">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>Email *</label>
                <input 
                  type="email" 
                  [(ngModel)]="profileData.email"
                  name="email"
                  required
                  class="form-control">
              </div>
              <div class="form-group">
                <label>Tel√©fono</label>
                <input 
                  type="tel" 
                  [(ngModel)]="profileData.phone"
                  name="phone"
                  class="form-control">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>DNI</label>
                <input 
                  type="text" 
                  [(ngModel)]="profileData.dni"
                  name="dni"
                  class="form-control">
              </div>
              <div class="form-group">
                <label>Fecha de Nacimiento</label>
                <input 
                  type="date" 
                  [(ngModel)]="profileData.birthDate"
                  name="birthDate"
                  class="form-control">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>G√©nero</label>
                <select 
                  [(ngModel)]="profileData.gender"
                  name="gender"
                  class="form-control">
                  <option value="">Seleccionar</option>
                  <option value="masculino">Masculino</option>
                  <option value="femenino">Femenino</option>
                  <option value="otro">Otro</option>
                  <option value="prefiero_no_decir">Prefiero no decir</option>
                </select>
              </div>
              <div class="form-group">
                <label>Direcci√≥n</label>
                <input 
                  type="text" 
                  [(ngModel)]="profileData.address"
                  name="address"
                  class="form-control">
              </div>
            </div>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="toggleEditMode()">Cancelar</button>
          <button type="submit" class="btn-save" [disabled]="!profileForm.valid || loading">
            {{ loading ? 'Guardando...' : 'Guardar Cambios' }}
          </button>
        </div>
      </form>

      <!-- View Mode -->
      <ng-template #viewMode>
        <div class="profile-view">
          <div class="view-section">
            <h3>Informaci√≥n Personal</h3>
            <div class="info-grid">
              <div class="info-item">
                <span class="label">Nombre:</span>
                <span class="value">{{ profileData.firstName || 'No especificado' }}</span>
              </div>
              <div class="info-item">
                <span class="label">Apellido:</span>
                <span class="value">{{ profileData.lastName || 'No especificado' }}</span>
              </div>
              <div class="info-item">
                <span class="label">Email:</span>
                <span class="value">{{ profileData.email || 'No especificado' }}</span>
              </div>
              <div class="info-item">
                <span class="label">Tel√©fono:</span>
                <span class="value">{{ profileData.phone || 'No especificado' }}</span>
              </div>
              <div class="info-item">
                <span class="label">DNI:</span>
                <span class="value">{{ profileData.dni || 'No especificado' }}</span>
              </div>
              <div class="info-item">
                <span class="label">Fecha de Nacimiento:</span>
                <span class="value">{{ profileData.birthDate ? (profileData.birthDate | date:'dd/MM/yyyy') : 'No especificado' }}</span>
              </div>
              <div class="info-item" *ngIf="calculatedAge">
                <span class="label">Edad:</span>
                <span class="value">{{ calculatedAge }} a√±os</span>
              </div>
              <div class="info-item">
                <span class="label">G√©nero:</span>
                <span class="value">{{ profileData.gender || 'No especificado' }}</span>
              </div>
              <div class="info-item">
                <span class="label">Direcci√≥n:</span>
                <span class="value">{{ profileData.address || 'No especificado' }}</span>
              </div>
            </div>
          </div>
        </div>
      </ng-template>
    </div>
  </div>
</div>